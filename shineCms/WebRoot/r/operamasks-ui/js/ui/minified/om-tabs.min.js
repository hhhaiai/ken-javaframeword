(function(){var c="om-tabs-"+(((1+Math.random())*65536)|0).toString(16).substring(1)+"-",b=0;function a(e,d){if(d.content){$(e).html(d.content)}return $(e).omPanel(d)}$.omWidget("om.omTabs",{options:{width:"auto",height:"auto",border:true,tabWidth:80,tabHeight:25,disabled:false,scrollable:true,closable:false,position:"top",switchMode:"click",autoPlay:false,interval:1000,active:0,lazyLoad:false,onBeforeActivate:function(e,d){},onActivate:function(e,d){},onBeforeClose:function(e,d){},onClose:function(e,d){},onBeforeCloseAll:function(d){},onCloseAll:function(){},onAdd:function(d,e){},onBeforeAdd:function(d,e){},onLoadComplete:function(d,e){}},add:function(d){this._add(d)},close:function(d){this._close(d)},closeAll:function(){this._closeAll()},activate:function(d){this._activate(d)},getAlter:function(d){return this._getAlter(d)},getActivated:function(){return this._getActivated()},getLength:function(){return this._getLength()},setDataSource:function(d){if(d.index===undefined||(!d.url&&!d.content)){return}this._setDataSource(d)},reload:function(e,d,f){this._reload(e,d,f)},doLayout:function(){this._doLayout()},_create:function(){var d=this.element;$.data(d,"omtabs",{});$.data(d,"omtabs").omtabs=this._makeSketch();$.data(d,"omtabs").items=this._collectItems();$.data(d,"omtabs").history=[]},_init:function(){this._render();this._afterRender();this._buildEvent()},_makeSketch:function(){var e=this.element,d=e.find(">ul").wrap('<div class="om-tabs-headers om-helper-reset om-helper-clearfix om-widget-header om-corner-all"></div>').parent().parent().addClass("om-tabs om-widget om-widget-content om-corner-all").append('<div class="om-tabs-panels om-widget-content om-corner-bottom"></div>');return d},_collectItems:function(){var d=this,h=this.element,g=this.options,f=[],e=[];h.find(">div.om-tabs-headers a").each(function(){var j=this.getAttribute("href",2);var n=j.split("#")[0],p;if(n&&(n===location.toString().split("#")[0]||(p=$("base")[0])&&n===p.href)){j=this.hash;this.href=j}var l=$(this);var k=l.attr("tabId")||l.attr("id")||c+b++;l.attr("tabId",k);var i={tabId:k,title:l.text(),_closeMode:"visibility",header:false,closed:true,onSuccess:function(q,s,r){d._trigger("onLoadComplete",null,i.tabId)},onError:function(r,s,q){d._trigger("onLoadComplete",null,i.tabId)}};var o=$(">"+j,h)[0];if(!o&&j.indexOf("#")!=0){if(g.lazyLoad===false){i.url=j}else{e.push({tabId:k,url:j,loaded:false})}}var m=new a(o||$("<div></div>")[0],i);f.push(m)});if(e.length>0){$.data(h,"omtabs").loadInfo=e}return f},_render:function(){var h=this.element,g=$.data(h,"omtabs"),f=this.options,e=g.omtabs,d=g.items;if(typeof f.active=="number"){if(f.active<0){f.active=0}if(f.active>d.length-1){f.active=d.length-1}}if(f.width=="fit"){e.css("width","100%")}else{if(f.width!="auto"){e.css("width",f.width);var i=isNaN(f.width)&&f.width.indexOf("%")!=-1;e.children(":first").css("width",i?"100%":f.width)}}if(f.height=="fit"){e.css("height","100%")}else{if(f.height!="auto"){e.css("height",f.height)}}this._renderHeader();this._renderBody()},_renderHeader:function(){var j=this.element,h=$.data(j,"omtabs"),e=this.options,d=h.omtabs;var g=d.find(">div.om-tabs-headers");var f=g.find("ul li");f.addClass("om-state-default om-corner-top");f.each(function(l){$("a.om-icon-close",$(this)).remove();var k=$(this).find("a:first");if($.browser.msie&&parseInt($.browser.version)==7){k.attr("hideFocus","true")}if(!k.hasClass("om-tabs-inner")){k.addClass("om-tabs-inner")}if(l===e.active||e.active===k.attr("tabId")){$(this).addClass("om-tabs-activated om-state-active");e.activeTabId=k.attr("tabId");e.active=l;h.history.push(e.activeTabId)}else{$(this).removeClass("om-tabs-activated om-state-active")}k.css({width:e.tabWidth,height:e.tabHeight});if(e.closable===true||($.isArray(e.closable)&&-1!==$.inArray(l,e.closable))){$('<a class="om-icon om-icon-close"></a>').insertAfter(k)}});var i=f.find("a.om-tabs-inner").height();f.parent().css({height:++i,"line-height":i+"px"});g.height(i+2);this._checkScroller()&&this._enableScroller()},_renderBody:function(){var k=this.element,g=$.data(k,"omtabs"),m=this.options,l=g.omtabs,h=g.items,d=l.find(">div.om-tabs-panels");d.children().detach();if(m.height!=="auto"){var e=l.innerHeight(),j=l.find(">div.om-tabs-headers").outerHeight();d.css("height",e-j)}m.border?l.removeClass("om-tabs-noborder"):l.addClass("om-tabs-noborder");var f=h.length;while(f--){h[f].addClass("om-state-nobd").parent().prependTo(d)}},_afterRender:function(){var k=this.element,j=$.data(k,"omtabs"),g=this.options,f=j.items,e=j.omtabs;var h=f.length;k.children().each(function(){if(!$(this).hasClass("om-tabs-headers")&&!$(this).hasClass("om-tabs-panels")){$(this).remove()}});if(!g.lazyLoad){$(f).omPanel("reload")}while(h--){var d=$(f[h]);if(h==g.active){d.omPanel("open")}else{d.omPanel("close")}}e.css("height",e.height());e.css("height",g.height)},_buildEvent:function(){var g=this,j=this.element,f=$.data(j,"omtabs"),l=this.options,k=f.omtabs;k.find(">div.om-tabs-headers a.om-icon-close").bind("click.omtabs",function(n){var m=$(n.target).prev().attr("tabId");g._close(m);return false});var d=k.find(">div.om-tabs-headers a.om-tabs-inner");if(l.switchMode.indexOf("mouseover")!=-1){d.bind("mouseover.omtabs",function(){var m=$(this).attr("tabId"),n=$.data(j,"activateTimer");(typeof n!=="undefined")&&clearTimeout(n);n=setTimeout(function(){g._activate(m);return false},500);$.data(j,"activateTimer",n)})}else{if(l.switchMode.indexOf("click")!=-1){d.bind("click.omtabs",function(){g._activate($(this).attr("tabId"))})}}d.bind("click.omtabs",function(){return false});if(l.autoPlay!=false){l.autoInterId=setInterval(function(){j.omTabs("activate","next")},l.interval)}else{clearInterval(l.autoInterId)}if(l.switchMode.indexOf("mouseover")==-1){var h=k.find(">div.om-tabs-headers li");var e=function(n,m){if(m.is(":not(.om-state-disabled)")){m.addClass("om-state-"+n)}};var i=function(n,m){m.removeClass("om-state-"+n)};h.bind("mouseover.omtabs",function(){e("hover",$(this))});h.bind("mouseout.omtabs",function(){i("hover",$(this))})}k.find(">div.om-tabs-headers >span").bind("click.omtabs",function(m){if($(this).hasClass("om-tabs-scroll-disabled")){return false}var n=$(this).parent().find("ul").children(":last").outerWidth(true);if($(this).hasClass("om-tabs-scroll-left")){g._scroll(n,g._scrollCbFn())}if($(this).hasClass("om-tabs-scroll-right")){g._scroll(-n,g._scrollCbFn())}return false})},_purgeEvent:function(){var h=this.element,g=$.data(h,"omtabs"),e=this.options,d=g.omtabs;var f=d.find(">div.om-tabs-headers");f.children().unbind(".omtabs");f.find(">ul >li >a").unbind(".omtabs");if(e.autoInterId){clearInterval(e.autoInterId)}},_activate:function(p){var u=this.element,y=$.data(u,"omtabs"),f=this.options,w=y.omtabs,o=y.items,g;var k=w.find(">div.om-tabs-headers ul");if(f.activeTabId==p||f.active==p){return false}p=p||0;var l,t=p;if(p=="next"){p=(f.active+1)%o.length}else{if(p=="prev"){p=(f.active-1)%o.length}}if(typeof p=="number"){t=this._getAlter(p)}else{if(typeof p=="string"){p=this._getAlter(p)}}if(f.onBeforeActivate&&this._trigger("onBeforeActivate",null,p)==false){return false}l=k.find("li a[tabId="+t+"]");l.parent().siblings().removeClass("om-tabs-activated om-state-active");l.parent().addClass("om-tabs-activated om-state-active");f.activeTabId=t;f.active=p;var r=o.length;for(r=o.length;r--;r>=0){var e=o[r];if(e.omPanel("option","tabId")==t){e.omPanel("open");if(g=this._getUnloadedUrl(t)){e.omPanel("reload",g);this._removeLoadInfo(t)}}}for(r=o.length;r--;r>=0){var e=o[r];if(e.omPanel("option","tabId")!=t){e.omPanel("close")}}if(this._checkScroller()){k.stop(true,true);u.clearQueue();var m=k.prev();var x=k.next();var q=l.parent().offset().left;var s=q+l.parent().outerWidth(true);var j=m.offset().left+m.outerWidth(true)+4-q;var d=x.offset().left-s;if(j>=0){this._scroll(j,this._scrollCbFn())}else{if(d<=0){this._scroll(d,this._scrollCbFn())}else{this._scrollCbFn()()}}}var v=y.history,h=y.history.length;while(v[--h]&&t!==v[h]){}h==-1?v.push(t):v.push(v.splice(h,1)[0]);f.onActivate&&this._trigger("onActivate",null,p)},_getUnloadedUrl:function(g){var e=$.data(this.element,"omtabs").loadInfo,d,f;if(e){d=e.length;while(f=e[--d]){if(f.tabId===g&&f.loaded===false){return f.url}}}return null},_removeLoadInfo:function(g){var e=$.data(this.element,"omtabs").loadInfo,d,f;if(e){d=e.length;while(f=e[--d]){if(f.tabId===g){e.splice(d,1);break}}}},_addLoadInfo:function(e,d){$.data(this.element,"omtabs").loadInfo.push({tabId:e,loaded:false,url:d})},_getAlter:function(g){var f=this.element,e=$.data(f,"omtabs").omtabs,d;if(typeof g=="number"){d=e.find(">div.om-tabs-headers li:nth-child("+ ++g+") a.om-tabs-inner").attr("tabId")}else{if(typeof g=="string"){e.find(">div.om-tabs-headers li a.om-tabs-inner").each(function(h){if($(this).attr("tabId")==g){d=h;return false}})}}return d},_getActivated:function(){return this.options.activeTabId},_add:function(f){var k=this,m=this.element,g=$.data(m,"omtabs"),p=this.options,n=g.omtabs,j=g.items;var h=n.find(">div.om-tabs-headers ul");var e=f.tabId?f.tabId:c+b++;f.index=f.index||"last";if(f.index=="last"||f.index>j.length-1){f.index=j.length}f.title=f.title||"New Title "+e;f.url=$.trim(f.url);f.content=$.trim(f.content);if(f.url){f.content=undefined}else{f.url=undefined;f.content=f.content||"New Content "+e}if(p.onBeforeAdd&&k._trigger("onBeforeAdd",null,f)==false){return false}var l=$('<li class="om-state-default om-corner-top"> </li>');var o=$('<a class="om-tabs-inner"></a>').html(f.title).attr({href:"#"+e,tabId:e}).css({width:p.tabWidth,height:p.tabHeight}).appendTo(l);if($.browser.msie&&parseInt($.browser.version)==7){o.attr("hideFocus","true")}if((f.closable===true)||(f.closable==undefined&&p.closable)){o.after('<a class="om-icon om-icon-close"></a>')}var i={tabId:e,title:o.text(),_closeMode:"visibility",header:false,closed:true,onSuccess:function(q,s,r){k._trigger("onLoadComplete",null,e)},onError:function(r,s,q){k._trigger("onLoadComplete",null,e)}};if(f.url){i.url=f.url}$.extend(i,f);var d=new a($("<div>"+(f.content||"")+"</div>")[0],i);if(f.index==j.length){j[f.index]=d;l.appendTo(h)}else{j.splice(f.index,0,d);h.children().eq(f.index).before(l)}if(h.innerWidth()-l.position().left<500){h.width(h.width()+500)}this._checkScroller()&&this._enableScroller();this._renderBody();this._purgeEvent();this._buildEvent();this._trigger("onAdd",null,i);this._activate(f.index)},_close:function(j){var m=this.element,h=$.data(m,"omtabs"),o=this.options,n=h.omtabs,k=h.items,l=n.find(">div.om-tabs-headers"),f=n.find(">div.om-tabs-panels"),g=n.height(),e=j,d=h.history;j=(j===undefined?o.active:j);if(typeof j=="string"){j=this._getAlter(j)}else{e=this._getAlter(j)}if(o.onBeforeClose&&this._trigger("onBeforeClose",null,j)==false){return false}this._removeLoadInfo(this._getAlter(j));l.find("li").eq(j).remove();f.children().find(">.om-panel-body").eq(j).remove();k.splice(j,1);if(f.children().length==0){f.css({height:g-l.outerHeight()})}var i=d.length;while(d[--i]&&e===d[i]){d.splice(i,1);break}o.onClose&&this._trigger("onClose",null,j);if(k.length==0){o.active=-1;o.activeTabId=null;return}else{if(j==o.active){o.active=-1;this._activate(d.length>0?d.pop():0)}else{j<o.active&&o.active--;this._checkScroller()&&this._enableScroller()}}},_closeAll:function(){var l=this.element,g=$.data(l,"omtabs"),n=this.options,m=g.omtabs,j=g.items,k=m.find(">div.om-tabs-headers"),d=m.find(">div.om-tabs-panels"),e=m.height();if(n.onBeforeCloseAll&&this._trigger("onBeforeCloseAll")==false){return false}for(var f=0,h=j.length;f<h;f++){this._removeLoadInfo(j[f].omPanel("option","tabId"))}k.find("li").remove();d.children().remove();j.splice(0,j.length);d.css({height:e-k.outerHeight()});n.active=-1;n.activeTabId=null;g.history=[];n.onCloseAll&&this._trigger("onCloseAll")},_checkScroller:function(){var k=this.element,f=$.data(k,"omtabs"),m=this.options,l=f.omtabs;if(!m.scrollable){return false}var g=l.find(">div.om-tabs-headers ul");var h=0,i=false;if(g.hasClass("om-tabs-scrollable")){i=true;g.removeClass("om-tabs-scrollable")}h+=parseInt(g.css("paddingLeft"))+parseInt(g.css("paddingRight"));if(i==true){i=false;g.addClass("om-tabs-scrollable")}g.children().each(function(){h+=$(this).outerWidth(true)});if(h>g.parent().innerWidth()){if(!g.hasClass("om-tabs-scrollable")){var j=$("<span></span>").insertBefore(g).addClass("om-tabs-scroll-left");var e=$("<span></span>").insertAfter(g).addClass("om-tabs-scroll-right");var d=(g.height()-j.height())/2;j.add(e).css({marginTop:d,marginBottom:d});g.addClass("om-tabs-scrollable")}return true}else{g.siblings().remove();g.removeClass("om-tabs-scrollable");return false}},_scrollCbFn:function(){var d=this;return function(){d._enableScroller()}},_enableScroller:function(){var l=this.element,n=$.data(l,"omtabs").omtabs,k=n.find(">div.om-tabs-headers"),i=k.children("ul"),m=i.prev(),h=i.next(),j=i.children(":last"),d=k.offset().left,g=h.offset().left,e=i.offset().left,f=j.offset().left+j.outerWidth(true);if(e<d){m.removeClass("om-tabs-scroll-disabled")}else{m.addClass("om-tabs-scroll-disabled")}if(f>g){h.removeClass("om-tabs-scroll-disabled")}else{h.addClass("om-tabs-scroll-disabled")}},_scroll:function(k,g){var i=this.element,d=$.data(i,"omtabs").omtabs,e=d.find(">div.om-tabs-headers ul"),j=e.children(":last");if(k==0){return}var f=k>0?e.prev().offset():e.next().offset();var h=function(m){if(k>0&&e.prev().hasClass(".om-tabs-scroll-disabled")||k<0&&e.next().hasClass(".om-tabs-scroll-disabled")){e.stop(true,true);i.clearQueue();return}var l=false;k=(k>0)?"+="+Math.min(f.left-e.offset().left,k):"-="+Math.min(j.offset().left+j.outerWidth(true)-f.left,Math.abs(k));$.data(i,"omtabs").isScrolling=true;e.animate({left:k+"px"},"normal","swing",function(){!!g&&g();$.data(i,"omtabs").isScrolling=false;m()})};i.queue(h);if(i.queue().length==1&&!$.data(i,"omtabs").isScrolling){i.dequeue()}},_getLength:function(){return $.data(this.element,"omtabs").items.length},_doLayout:function(){this._checkScroller()&&this._enableScroller()},_setDataSource:function(g){var h=this.element,d=$.data(h,"omtabs").items,f=this.options,e=this._getAlter(g.index);g.url=$.trim(g.url);g.content=$.trim(g.content);if(g.url){if(f.lazyLoad!==false){this._addLoadInfo(e,g.url);d[g.index].omPanel("option","url",g.url)}else{this._removeLoadInfo(e);d[g.index].omPanel("reload",g.url)}}else{d[g.index].html(g.content)}},_reload:function(g,f,h){var i=this.element,d=$.data(i,"omtabs").items,e=this._getAlter(g);if(f){this._removeLoadInfo(e);d[g].omPanel("reload",f)}else{if(h){d[g].html(h)}else{d[g].omPanel("reload",this._getUnloadedUrl(e));this._removeLoadInfo(e)}}}})})(jQuery);